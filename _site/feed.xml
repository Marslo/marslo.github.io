<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>I, Marslo</title>
    <description>&lt;h2&gt;Hello, there!&lt;/h2&gt;&lt;h1&gt;Welcome to my world!&lt;/h1&gt;</description>
    <link>http://localhost:4000/</link>
    <atom:link href="http://localhost:4000/feed.xml" rel="self" type="application/rss+xml"/>
    <pubDate>Mon, 30 Sep 2019 14:14:46 +0800</pubDate>
    <lastBuildDate>Mon, 30 Sep 2019 14:14:46 +0800</lastBuildDate>
    <generator>Jekyll v4.0.0</generator>
    
      <item>
        <title>1.15.3 HA kubernetes Cluster Playbook (basic environment)</title>
        <description>&lt;!-- START doctoc generated TOC please keep comment here to allow auto update --&gt;
&lt;!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE --&gt;
&lt;p&gt;&lt;strong&gt;Table of Contents&lt;/strong&gt;  &lt;em&gt;generated with &lt;a href=&quot;https://github.com/thlorenz/doctoc&quot;&gt;DocToc&lt;/a&gt;&lt;/em&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;#extended-etcd-topology&quot;&gt;Extended etcd Topology&lt;/a&gt;
    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#kubernetes-ha-cluster-with-external-etcd&quot;&gt;Kubernetes HA cluster with external etcd&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#server-matrix&quot;&gt;Server Matrix&lt;/a&gt;
        &lt;ul&gt;
          &lt;li&gt;&lt;a href=&quot;#environment-list&quot;&gt;Environment List&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#etchosts&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/hosts&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#variables&quot;&gt;variables&lt;/a&gt;&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#tools-installation&quot;&gt;Tools Installation&lt;/a&gt;
    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#cfssl--cfssljson&quot;&gt;cfssl &amp;amp; cfssljson&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#etcd&quot;&gt;etcd&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#keepalived&quot;&gt;keepalived&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#haproxy&quot;&gt;haproxy&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#helm&quot;&gt;helm&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#docker&quot;&gt;docker&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;!-- END doctoc generated TOC please keep comment here to allow auto update --&gt;

&lt;h1 id=&quot;extended-etcd-topology&quot;&gt;Extended etcd Topology&lt;/h1&gt;
&lt;h2 id=&quot;kubernetes-ha-cluster-with-external-etcd&quot;&gt;&lt;a href=&quot;https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/ha-topology/#external-etcd-topology&quot;&gt;Kubernetes HA cluster with external etcd&lt;/a&gt;&lt;/h2&gt;

&lt;p&gt;&lt;img src=&quot;http://localhost:4000/images/external-etcd-topology.png&quot; style=&quot;width: 666px;&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;server-matrix&quot;&gt;Server Matrix&lt;/h2&gt;

&lt;h3 id=&quot;environment-list&quot;&gt;Environment List&lt;/h3&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;| Hostname   | IP Address      | etcd              |
|------------|-----------------|-------------------|
| master01   | 192.168.100.200 | master01 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;etcd-0&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; |
| master02   | 192.168.100.201 | master02 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;etcd-1&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; |
| master03   | 192.168.100.202 | master03 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;etcd-2&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; |
| node01     | 192.168.100.203 |                   |
| node02     | 192.168.100.204 |                   |
|            |                 |                   |
| virtual IP | 192.168.100.250 |                   |
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;etchosts&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/hosts&lt;/code&gt;&lt;/h3&gt;

&lt;p&gt;Add for all servers&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;192.168.100.200     master01
192.168.100.201     master02
192.168.100.202     master03
192.168.100.203     worker01
192.168.100.204     worker02

192.168.100.250     jenkins.marslo.com
192.168.100.250     prometheus.marslo.com
192.168.100.250     grafana.marslo.com
192.168.100.250     dashboard.marslo.com
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;variables&quot;&gt;variables&lt;/h3&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;master01Name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;master01&quot;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;master02Name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;master02&quot;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;master03Name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;master03&quot;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;master01IP&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;192.168.100.200&quot;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;master01IP&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;192.168.100.201&quot;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;master01IP&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;192.168.100.202&quot;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;virtualIP&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;192.168.100.250&quot;&lt;/span&gt;

&lt;span class=&quot;nv&quot;&gt;leadIP&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;master01IP&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;leadName&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;master01Name&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;

&lt;span class=&quot;nv&quot;&gt;k8sVer&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;v1.15.3&quot;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;etcdVer&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'v3.3.15'&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;keepaliveVer&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'2.0.18'&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;haproxyVer&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;2.0.6&quot;&lt;/span&gt;

&lt;span class=&quot;nv&quot;&gt;etcdPath&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'/etc/etcd/ssl

interface=$(netstat -nr | grep -E '&lt;/span&gt;UG|UGSc&lt;span class=&quot;s1&quot;&gt;' | grep -E '&lt;/span&gt;^0.0.0|default&lt;span class=&quot;s1&quot;&gt;' | grep -E '&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;0-9.]&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;7,15&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;' | awk -F'&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;' '&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;print &lt;span class=&quot;nv&quot;&gt;$NF&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;')
ipAddr=$(ip a s &quot;${interface}&quot; | sed -rn '&lt;/span&gt;s|.&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;inet &lt;span class=&quot;o&quot;&gt;([&lt;/span&gt;0-9&lt;span class=&quot;se&quot;&gt;\.&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]{&lt;/span&gt;7,15&lt;span class=&quot;o&quot;&gt;})&lt;/span&gt;/[0-9]&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;2&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; brd.&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$|&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\1&lt;/span&gt;|p&lt;span class=&quot;s1&quot;&gt;')
peerName=$(hostname)
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h1 id=&quot;tools-installation&quot;&gt;Tools Installation&lt;/h1&gt;
&lt;h2 id=&quot;cfssl--cfssljson&quot;&gt;cfssl &amp;amp; cfssljson&lt;/h2&gt;

&lt;h2 id=&quot;etcd&quot;&gt;etcd&lt;/h2&gt;

&lt;h2 id=&quot;keepalived&quot;&gt;keepalived&lt;/h2&gt;

&lt;h2 id=&quot;haproxy&quot;&gt;haproxy&lt;/h2&gt;

&lt;h2 id=&quot;helm&quot;&gt;helm&lt;/h2&gt;

&lt;h2 id=&quot;docker&quot;&gt;docker&lt;/h2&gt;
</description>
        <pubDate>Wed, 25 Sep 2019 16:47:24 +0800</pubDate>
        <link>http://localhost:4000/kubernetes/2019/09/25/ha-cluster-step1.html</link>
        <guid isPermaLink="true">http://localhost:4000/kubernetes/2019/09/25/ha-cluster-step1.html</guid>
        
        
        <category>kubernetes</category>
        
      </item>
    
      <item>
        <title>Hello World!</title>
        <description>&lt;p&gt;Awesome Marslo! &lt;br /&gt;
This is my first post.&lt;/p&gt;
</description>
        <pubDate>Fri, 28 Apr 2017 19:23:24 +0800</pubDate>
        <link>http://localhost:4000/marslo/2017/04/28/fist-post.html</link>
        <guid isPermaLink="true">http://localhost:4000/marslo/2017/04/28/fist-post.html</guid>
        
        
        <category>marslo</category>
        
      </item>
    
  </channel>
</rss>
